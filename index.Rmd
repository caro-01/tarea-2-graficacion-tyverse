---
title: "Tarea 2: Graficación con Tidyverse"
output: html_document
---

```{r}
# dplyr
library(dplyr)
```

```{r}
# Carga de graphics
library(graphics)
```

```{r}
# Carga de ggplot2
library(ggplot2)
```

```{r}
# Carga de plotly
library(plotly)
```

```{r}
# Carga de tidyverse
library(tidyverse)
```

## 1. Realizar un gráfico de barras apiladas que muestre el caudal de los ríos Pandora y Bananito por cada uno de los 12 meses del año:


```{r}
# Carga de datos desde un archivo CSV
rios <-
  read.csv(file = 'https://raw.githubusercontent.com/tpb728O-programaciongeoespacialr/2021ii/main/datos/hidrologia/fdc/fdc.csv')
```

```{r Cambiar nombre columas ríos}
# Cambio de nombre de las columnas mediante rename()
rios <-
  rios %>%
  rename(fecha = Tiempo,
         pandora = Pandora.mm..637km2.,
         banano = Banano.mm..90km2.)
```

```{r Convertir columna fecha}
# Conversión de una columna a tipo Date y creación de una nueva columna
rios <-
  rios %>%
  mutate(fecha = as.Date(fecha, format = "%m/%d/%Y"),
         promedio = (pandora + banano) / 2)
```

```{r Sumarización} 
# Selección, renombramiento, filtrado y conversión de columnas rios_sumarizado_x_mes 
rios_sumarizados_x_mes <-  
  rios %>%  
  select(fecha, pandora, banano) %>%   
  rename(fecha = fecha, caudal_pandora = pandora, caudal_banano = banano) %>%  
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y")) %>%   
  group_by( mes = format(fecha,"%m")) %>%   
  summarise(Total_mes_pandora = sum(caudal_pandora ), Total_mes_banano = sum(caudal_banano)) 

# Despliegue del data frame con los resultados rios_sumarizado_x_mes ```
rios_sumarizados_x_mes

```

```{r Gráfico_ barras_apilado}
# Generación de un nuevo data frame

ggplot(
  rios_sumarizados_x_mes, 
  aes(x = mes, y = Total_mes_pandora, Total_mes_banano)
) +
  
geom_col(position = "dodge") +
  coord_flip() +
  ggtitle("Sumatoria del caudal de los ríos Pandora y Banano") +
  xlab("Mes") +
  ylab("Total caudal") +
  theme_modern_rc()

```

```{r}
# Carga de datos desde un archivo CSV
covid <- 
  read.csv(
    file='https://raw.githubusercontent.com/tpb728O-programaciongeoespacialr/2021ii/main/datos/minsalud/covid/ultimafecha_CSV_GENERAL.csv', 
    sep = ","
  )
```

```{r Preparar datos Covid}

# Histograma de casos nuevos de positivos de Covid - 19

covid_histo <-
  covid %>%
  select(FECHA, nue_posi) %>%
  rename(fecha = FECHA, nuevos_positivos = nue_posi) %>%
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y"))

```

```{r hacer_gráfico}
ggplot(covid_histo, aes(x = fecha, y = nuevos_positivos)) +
  geom_histogram(stat= 'identity', color= "dark blue", binwidth = 2) +
  ggtitle("Distribución de casos nuevos positivos de Covid-19, Costa Rica") +
  xlab("Fecha") +
  ylab("Casos nuevos") +
  theme_replace()
```

```{r Cambiar nombre columnas Covid}
# Cambio de nombre de las columnas mediante rename()
covid <-
  covid %>%
  rename(fecha = FECHA,
         mujeres_fallecidas = muj_fall,
         hombres_fallecidos = hom_fall)
```

```{r Conversión columna datos Covid}
# Conversión de una columna a tipo Date y creación de una nueva columna
covid <-
  covid %>%
  mutate (fecha = as.Date(fecha, format = "%m/%d/%Y"),
         promedio = (mujeres_fallecidas + hombres_fallecidos) / 2)
```

```{r}
# Selección, renombramiento, filtrado y conversión de columnas rios_sumarizado_x_mes 
datos_covid_sumarizados_x_mes <-  
  covid %>%  
  select(fecha, mujeres_fallecidas, hombres_fallecidos) %>%   
  rename(fecha = fecha, mujeres = mujeres_fallecidas, hombres = hombres_fallecidos) %>%  
  mutate(fecha = as.Date(fecha, format = "%d/%m/%Y")) %>%   
  group_by( mes = format(fecha,"%m")) %>% 
  summarise(suma_mujeres_fallecidas = sum(mujeres), suma_hombres_fallecidos = sum(hombres)) 

# Despliegue del data frame con los resultados rios_sumarizado_x_mes ```
datos_covid_sumarizados_x_mes
```
